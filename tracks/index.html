<!DOCTYPE html>
<html lang="en">
<head>
	<title>Stunt Rally Online Track Browser</title>
	<link href="css/bootstrap.min.css" rel="stylesheet">
	<style type="text/css">
		html, body, #container, .content-row, .content-row:first-child { height: 100%; }
		body { background-color: #E0F0FF; font-family:Sans-Serif; }
		#container { display: none; position: absolute; top: 0px; bottom: 0px; }
		img { width: 100%; }
		#road { margin-top: -100% }
		#tracks { overflow: auto; height: 90%; list-style: none; margin: 2px; }
		li { font-size: 0.8em; margin-left: 0px; }
		.sel { background-color: #AEA; border-radius: 7px; }
		#headerline div { padding: 5px; background-color: #BDF; border-radius: 5px; }
		#headerline { margin: 8px 0px; }
		#view { max-width: 768px; }
		#stats { margin-top: 10px; }
	</style>
</head>
<body>

<h2 id="loading">Track browser loading...</h2>
<div id="container" class="container-fluid">
	<div id="headerline" class="row-fluid">
		<div class="span2">Tracks</div>
		<div class="span3" id="track-title">Pick a track form the list...</div>
		<div class="span7">
			View
			<a type="button" class="btn btn-mini" id="prev" href="#" title="Previous track">&lt;&lt;</a>
			<a type="button" class="btn btn-mini" id="next" href="#" title="Next track">&gt;&gt;</a>
		</div>
	</div>
	<div id="content-row" class="row-fluid">
		<div class="span2">
			<ul id="tracks"><!-- Populated from JavaScript--></ul>
		</div>
		<div class="span3">
			<img id="ter" src="" alt="" title="" />
			<img id="road" src="" alt="Minimap" title="2D Minimap, road and terrain" />
			<div id="stats">
				<p>Scenery: <span id="scenery"></span></p>
				<p>Rating: <span id="rating"></span></p>
				<p>Difficulty: <span id="difficulty"></span></p>
			</div>
		</div>
		<div class="span7">
			<img id="view" src="" alt="View" title="Track 3D view" />
		</div>
	</div>
</div>

<script>
	function lnk(s) { return '?id='+s; }

	//  get id from url
	function getPar(name)
	{
		var ch = "[\\?&]"+name+"=([^&#]*)";
		var re = new RegExp(ch);
		var sr = re.exec(window.location.href);

		if (sr != null)  return sr[1];
		else  return "";
	}

	var id = getPar('id');  // trk name

	if (id != '')
		document.getElementById("track-title").innerHTML = id;

	//  config  repo url  ----
	var raw = "https://raw.github.com/stuntrally/";
	var trks = raw + "tracks/master/";

	var adiff = ["Test Easy","Very Easy","Easy","Medium","Hard","Very Hard","Extreme","Ultra"];

	if (window.XMLHttpRequest)
	{  xh = new XMLHttpRequest();
	} else  // IE5,6
	{  xh = new ActiveXObject("Microsoft.XMLHTTP");  }
	
	xh.onreadystatechange = function()
	{
		if (xh.readyState == 4 && xh.status == 200)
		{
			var xmlDoc = xh.responseXML;
			var txt = "";
			var x = xmlDoc.getElementsByTagName("track");
			var ar = [];

			if (!id && x.length) id = x[(Math.random() * x.length)|0].getAttribute('name');

			for (var i = 0; i < x.length; ++i)
			{
				//created crtver modified author
				//objects fluids bumps jumps loops pipes banked frenzy long
				var name = x[i].getAttribute('name');
				if (name == id)
				{
					var t = trks + id + "/preview/";
					document.getElementById("view").src = t + "view.jpg";
					document.getElementById("ter").src = t + "terrain.jpg";
					document.getElementById("road").src = t + "road.png";

					document.getElementById("scenery").innerHTML = x[i].getAttribute('scenery');
					document.getElementById("rating").innerHTML = x[i].getAttribute('rating');
					document.getElementById("difficulty").innerHTML = adiff[x[i].getAttribute('diff')];
				}
				ar.push(name);
			}
			ar.sort();

			var l = ar.length, q = -1;
			for (var n = 0; n < l; ++n)
			{
				if (ar[n] == id)  {  txt = txt + "<li class='sel'><a";  q = n;  }
				else  txt = txt + "<li><a ";
				txt = txt + "href='"+lnk(ar[n])+"' id='"+ar[n]+"'>" + ar[n] + "</a></li>";
			}
			if (q-1 >=0) document.getElementById("prev").href = lnk(ar[q-1]);
			if (q+1 < l) document.getElementById("next").href = lnk(ar[q+1]);

			var list = document.getElementById("tracks");
			list.innerHTML = txt;
			if (id != '')  // center
				list.scrollTop = document.getElementById(id).offsetTop - 100;

			document.getElementById("loading").style.display = "none";
			document.getElementById("container").style.display = "block";
		}
	}

	xh.open("GET", "tracks.xml", false);
	xh.send();
</script>

</body>
</html>
