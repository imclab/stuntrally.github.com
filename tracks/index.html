<!DOCTYPE html>
<html lang="en">
<head>
	<title>Stunt Rally Online Track Browser</title>
	<link href="css/bootstrap.min.css" rel="stylesheet">
	<style type="text/css">
		html, body, #container, .content-row, .content-row:first-child { height: 100%; }
		body { background-color: #E0F0FF; font-family:Sans-Serif; }
		#container { position: absolute; top: 0px; bottom: 0px; }
		img { width: 100%; }
		#road { margin-top: -100% }
		#tracks { overflow: auto; height: 90%; list-style: none; }
		li { padding: 2px; }
		.sel { background-color: #AEA; border-radius: 7px; }
		#view { max-width: 768px; }
	</style>
</head>
<body>

<div id="container" class="container-fluid">
	<div class="row-fluid">
		<div class="span2">Tracks</div>
		<div class="span3" id="track-title">Pick a track form the list...</div>
		<div class="span7">
			View
			<a type="button" class="btn btn-mini" id="prev" href="#" title="Previous track">&lt;&lt;</a>
			<a type="button" class="btn btn-mini" id="next" href="#" title="Next track">&gt;&gt;</a>
		</div>
	</div>
	<div id="content-row" class="row-fluid">
		<div class="span2">
			<ul id="tracks"><!-- Populated from JavaScript--></ul>
		</div>
		<div class="span3">
			<img id="ter" src="" alt="" title="" />
			<img id="road" src="" alt="Minimap" title="2D Minimap, road and terrain" />
			<div id="stats"></div>
		</div>
		<div class="span7">
			<img id="view" src="" alt="View" title="Track 3D view" />
		</div>
	</div>
</div>

<script>
	function lnk(s) { return '?id='+s; }

	//  get id from url
	function getPar(name)
	{
		ch = "[\\?&]"+name+"=([^&#]*)";
		re = new RegExp(ch);
		sr = re.exec(window.location.href);

		if (sr != null)  return sr[1];
		else  return "";
	}

	var id = getPar('id');  // trk name

	if (id != '')
		document.getElementById("track-title").innerHTML = id;

	//  config  repo url  ----
	var raw = "https://raw.github.com/stuntrally/";
	var trks = raw + "tracks/master/";

	var adiff = ["Test Easy","Very Easy","Easy","Medium","Hard","Very Hard","Extreme","Ultra"];

	if (window.XMLHttpRequest)
	{  xh = new XMLHttpRequest();
	} else  // IE5,6
	{  xh = new ActiveXObject("Microsoft.XMLHTTP");  }
	
	xh.onreadystatechange = function()
	{
		if (xh.readyState == 4 && xh.status == 200)
		{
			var xmlDoc = xh.responseXML;
			var txt = "";
			var x = xmlDoc.getElementsByTagName("track");
			var ar = [];
			for (var i = 0; i < x.length; ++i)
			{
				//created crtver modified author
				//objects fluids bumps jumps loops pipes banked frenzy long
				name = x[i].getAttribute('name');
				if (name == id)
				{
					sc = x[i].getAttribute('scenery');
					//num = x[i].getAttribute('n');
					rat = x[i].getAttribute('rating');
					diff = x[i].getAttribute('diff');

					t = trks + id + "/preview/";
					document.getElementById("view").src = t+"view.jpg";
					document.getElementById("ter").src = t+"terrain.jpg";
					document.getElementById("road").src = t+"road.png";

					document.getElementById("stats").innerHTML =
						//"Number: "+num+"<br/>"+
						"Scenery: "+sc+"<br/><br/>"+
						"Rating: "+rat+"<br/><br/>"+
						"Difficulty: "+adiff[diff]+"<br/>";
				}
				ar.push(name);
			}
			ar.sort();
			
			l = ar.length, q = -1;
			for (var n = 0; n < l; ++n)
			{
				if (ar[n] == id)  {  txt = txt + "<li class='sel'><a";  q = n;  }
				else  txt = txt + "<li><a ";
				txt = txt + "href='"+lnk(ar[n])+"' id='"+ar[n]+"'>" + ar[n] + "</a></li>";
			}
			if (q-1 >=0) document.getElementById("prev").href = lnk(ar[q-1]);
			if (q+1 < l) document.getElementById("next").href = lnk(ar[q+1]);

			list = document.getElementById("tracks");
			list.innerHTML = txt;
			if (id != '')  // center
				list.scrollTop = document.getElementById(id).offsetTop - 100;
		}
	}

	xh.open("GET", "tracks.xml", false);
	xh.send();
</script>

</body>
</html>
